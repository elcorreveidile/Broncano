<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ Broncano App - Las Dos Preguntas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.panic-mode {
            background: #ffffff;
            color: #000000;
        }

        body.panic-mode .container {
            display: none;
        }

        body.panic-mode::after {
            content: 'Excel - Presupuesto Anual 2024';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #000;
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
            position: relative;
        }

        .panic-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 0, 0, 0.3);
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s;
        }

        .panic-btn:hover {
            background: rgba(255, 0, 0, 0.6);
            color: #fff;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: neonGlow 3s ease-in-out infinite;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .subtitle {
            color: #00ffff;
            font-size: 1.2em;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .broncano-quote {
            background: rgba(255, 0, 255, 0.1);
            border-left: 4px solid #ff00ff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .section {
            background: rgba(20, 20, 30, 0.8);
            border: 2px solid #ff00ff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
            animation: fadeInUp 0.8s ease;
            backdrop-filter: blur(10px);
        }

        .section:nth-child(even) {
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            color: #ff00ff;
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
        }

        .section:nth-child(even) .section-title {
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .display {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #39ff14;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: inset 0 0 20px rgba(57, 255, 20, 0.2);
        }

        .display-label {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .display-value {
            font-size: 3em;
            font-weight: bold;
            color: #39ff14;
            text-shadow: 0 0 20px rgba(57, 255, 20, 0.8);
            font-family: 'Courier New', monospace;
        }

        .display-currency {
            font-size: 0.8em;
            color: #888;
            margin-left: 5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-add {
            background: linear-gradient(45deg, #39ff14, #00cc00);
            color: #000;
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.5);
        }

        .btn-add:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(57, 255, 20, 0.8);
        }

        .btn-subtract {
            background: linear-gradient(45deg, #ff0055, #cc0044);
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
        }

        .btn-subtract:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(255, 0, 85, 0.8);
        }

        .btn-petting {
            background: linear-gradient(45deg, #ff00ff, #cc00cc);
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .btn-petting:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(255, 0, 255, 0.8);
        }

        .btn-masturbacion {
            background: linear-gradient(45deg, #00ffff, #0099cc);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .btn-masturbacion:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(0, 255, 255, 0.8);
        }

        .btn-completa {
            background: linear-gradient(45deg, #ffff00, #cccc00);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }

        .btn-completa:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(255, 255, 0, 0.8);
        }

        .btn-reset {
            background: linear-gradient(45deg, #ff6600, #cc5500);
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
            width: 100%;
        }

        .btn-reset:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(255, 102, 0, 0.8);
        }

        .btn-special {
            background: linear-gradient(45deg, #9400d3, #4b0082);
            color: #fff;
            box-shadow: 0 0 20px rgba(148, 0, 211, 0.5);
        }

        .btn-special:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(148, 0, 211, 0.8);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        input[type="number"] {
            flex: 1;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #39ff14;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: #39ff14;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        input[type="number"]:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.5);
        }

        .points-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .point-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .point-card:hover {
            transform: translateY(-5px);
            border-color: #39ff14;
        }

        .point-label {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 5px;
        }

        .point-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #39ff14;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            opacity: 0.4;
        }

        .achievement.unlocked {
            opacity: 1;
            border-color: #39ff14;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
        }

        .achievement-icon {
            font-size: 2.5em;
            margin-bottom: 8px;
        }

        .achievement-name {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 3px;
        }

        .achievement.unlocked .achievement-name {
            color: #39ff14;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #39ff14;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            color: #888;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 5% auto;
            padding: 40px;
            border: 2px solid #ff00ff;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.5);
            animation: slideIn 0.3s;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ff00ff;
        }

        .modal-title {
            color: #ff00ff;
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: #000;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
            z-index: 2000;
            animation: slideInRight 0.5s, pulse 1s infinite;
            font-weight: bold;
            max-width: 300px;
        }

        .notification-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 30px;
            margin: 15px 0;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            background: linear-gradient(90deg, #39ff14, #00cc00);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            color: #000;
        }

        .history-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #39ff14;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 0.9em;
        }

        .emoji {
            font-size: 1.3em;
        }

        @keyframes neonGlow {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2em;
            }

            .section-title {
                font-size: 1.5em;
            }

            .display-value {
                font-size: 2.5em;
            }

            .btn {
                min-width: 100px;
                padding: 12px 20px;
                font-size: 1em;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .panic-btn {
                position: relative;
                display: block;
                width: 100%;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="panic-btn" onclick="togglePanicMode()">üö® MODO P√ÅNICO</button>
            <h1>üé¨ BRONCANO APP</h1>
            <div class="subtitle">Las Dos Preguntas Cl√°sicas</div>
        </header>

        <!-- Frase de Broncano -->
        <div class="broncano-quote" id="broncanoQuote">
            "¬øPero cu√°ntas veces?"
        </div>

        <!-- Secci√≥n Patrimonio -->
        <div class="section" id="patrimonioSection">
            <h2 class="section-title"><span class="emoji">üí∞</span> PREGUNTA 1: ¬øCU√ÅNTO DINERO TIENES?</h2>

            <div class="display" id="patrimonioDisplayBox">
                <div class="display-label">Patrimonio Total</div>
                <div class="display-value">
                    <span id="patrimonioDisplay">0</span><span class="display-currency">‚Ç¨</span>
                </div>
            </div>

            <div id="patrimonioGoal"></div>

            <div class="input-group">
                <input type="number" id="patrimonioInput" placeholder="Cantidad (‚Ç¨)" value="1000" min="0" step="100">
            </div>

            <div class="controls">
                <button class="btn btn-add" onclick="modificarPatrimonio(true)">
                    <span><span class="emoji">‚ûï</span> A√±adir</span>
                </button>
                <button class="btn btn-subtract" onclick="modificarPatrimonio(false)">
                    <span><span class="emoji">‚ûñ</span> Restar</span>
                </button>
            </div>

            <div class="controls">
                <button class="btn btn-special" onclick="mostrarModalObjetivos('patrimonio')" style="width: 100%;">
                    <span><span class="emoji">üéØ</span> Establecer Objetivo</span>
                </button>
            </div>
        </div>

        <!-- Secci√≥n Relaciones -->
        <div class="section" id="relacionesSection">
            <h2 class="section-title"><span class="emoji">üî•</span> PREGUNTA 2: ¬øCU√ÅNTAS VECES ESTE MES?</h2>

            <div class="display" id="relacionesDisplayBox">
                <div class="display-label">Puntuaci√≥n Total del Mes</div>
                <div class="display-value">
                    <span id="relacionesDisplay">0</span><span class="display-currency">pts</span>
                </div>
            </div>

            <div id="relacionesGoal"></div>

            <div class="points-info">
                <div class="point-card">
                    <div class="point-label">Petting</div>
                    <div class="point-value">0.3 pts</div>
                </div>
                <div class="point-card">
                    <div class="point-label">Masturbaci√≥n</div>
                    <div class="point-value">0.5 pts</div>
                </div>
                <div class="point-card">
                    <div class="point-label">Completa</div>
                    <div class="point-value">1 pt</div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-petting" onclick="agregarRelacion(0.3)">
                    <span><span class="emoji">üíã</span> Petting</span>
                </button>
                <button class="btn btn-masturbacion" onclick="agregarRelacion(0.5)">
                    <span><span class="emoji">‚úä</span> Masturbaci√≥n</span>
                </button>
                <button class="btn btn-completa" onclick="agregarRelacion(1)">
                    <span><span class="emoji">üîû</span> Completa</span>
                </button>
            </div>

            <div class="controls">
                <button class="btn btn-special" onclick="mostrarModalObjetivos('relaciones')" style="flex: 1;">
                    <span><span class="emoji">üéØ</span> Objetivo</span>
                </button>
                <button class="btn btn-reset" onclick="resetRelaciones()" style="flex: 1;">
                    <span><span class="emoji">üîÑ</span> Reset</span>
                </button>
            </div>
        </div>

        <!-- Secci√≥n Logros -->
        <div class="section">
            <h2 class="section-title"><span class="emoji">üèÜ</span> LOGROS Y PREMIOS</h2>
            <div class="achievements-grid" id="achievementsGrid"></div>
        </div>

        <!-- Secci√≥n Estad√≠sticas -->
        <div class="section">
            <h2 class="section-title"><span class="emoji">üìä</span> ESTAD√çSTICAS</h2>
            <div class="stats-grid" id="statsGrid"></div>
            <div class="controls" style="margin-top: 20px;">
                <button class="btn btn-special" onclick="mostrarModalHistorial()">
                    <span><span class="emoji">üìà</span> Ver Historial</span>
                </button>
                <button class="btn btn-special" onclick="mostrarModalCalculadora()">
                    <span><span class="emoji">üßÆ</span> Calculadora</span>
                </button>
            </div>
        </div>

        <!-- Secci√≥n Utilidades -->
        <div class="section">
            <h2 class="section-title"><span class="emoji">‚öôÔ∏è</span> UTILIDADES</h2>
            <div class="controls">
                <button class="btn btn-special" onclick="exportarPDF()">
                    <span><span class="emoji">üìÑ</span> Exportar PDF</span>
                </button>
                <button class="btn btn-special" onclick="exportarJSON()">
                    <span><span class="emoji">üíæ</span> Backup JSON</span>
                </button>
            </div>
            <div class="controls" style="margin-top: 0;">
                <button class="btn btn-special" onclick="document.getElementById('importFile').click()" style="width: 100%;">
                    <span><span class="emoji">üìÇ</span> Importar Backup</span>
                </button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importarDatos(this)">
            <div id="comparadorInfo" style="margin-top: 20px; text-align: center; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;"></div>
        </div>

        <footer>
            <p>Inspirado en "La Revuelta" de David Broncano</p>
            <p style="margin-top: 10px; font-size: 0.8em;">Los datos se guardan autom√°ticamente en tu navegador</p>
            <p style="margin-top: 15px; font-size: 0.9em; color: #888;">
                Dise√±ado y desarrollado por
                <a href="https://instagram.com/jabelainez" target="_blank" rel="noopener noreferrer" style="color: #ff00ff; text-decoration: none; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.textShadow='0 0 10px rgba(255, 0, 255, 0.8)'; this.style.color='#00ffff';" onmouseout="this.style.textShadow='none'; this.style.color='#ff00ff';">
                    Javier Ben√≠tez L√°inez
                </a>
            </p>
        </footer>
    </div>

    <!-- Modales -->
    <div id="achievementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('achievementModal')">&times;</span>
            <h2 class="modal-title">üéâ ¬°LOGRO DESBLOQUEADO!</h2>
            <div id="achievementContent"></div>
        </div>
    </div>

    <div id="historialModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('historialModal')">&times;</span>
            <h2 class="modal-title">üìà HISTORIAL MENSUAL</h2>
            <div id="historialContent"></div>
        </div>
    </div>

    <div id="calculadoraModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('calculadoraModal')">&times;</span>
            <h2 class="modal-title">üßÆ CALCULADORA DE PROYECCIONES</h2>
            <div id="calculadoraContent"></div>
        </div>
    </div>

    <div id="objetivosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('objetivosModal')">&times;</span>
            <h2 class="modal-title">üéØ ESTABLECER OBJETIVO</h2>
            <div id="objetivosContent"></div>
        </div>
    </div>

    <script>
        // ===== DATOS Y CONFIGURACI√ìN =====
        let patrimonio = parseFloat(localStorage.getItem('broncano_patrimonio')) || 0;
        let relacionesPuntos = parseFloat(localStorage.getItem('broncano_relaciones')) || 0;
        let logrosDesbloqueados = JSON.parse(localStorage.getItem('broncano_logros')) || [];
        let historial = JSON.parse(localStorage.getItem('broncano_historial')) || [];
        let objetivos = JSON.parse(localStorage.getItem('broncano_objetivos')) || {};
        let stats = JSON.parse(localStorage.getItem('broncano_stats')) || {
            totalRelaciones: 0,
            mejorMes: 0,
            peorMes: Infinity,
            rachaActual: 0,
            mejorRacha: 0,
            ultimaActividad: null
        };

        const frasesBroncano = [
            "¬°Eso es dinero!",
            "¬øPero cu√°ntas veces?",
            "Tremendo dato",
            "No me lo creo",
            "Eso s√≠ que es interesante",
            "Ah√≠ est√° la clave",
            "Muy fuerte",
            "No puede ser",
            "Incre√≠ble",
            "Eso hay que celebrarlo",
            "Qu√© barbaridad",
            "Me encanta este dato",
            "Brutal",
            "Esto es oro puro",
            "Fant√°stico",
            "No tiene precio",
            "Maravilloso",
            "Espectacular"
        ];

        const logrosDefinicion = [
            // Logros de Patrimonio
            { id: 'mileurista', nombre: 'El Mileurista', icono: 'üí∏', condicion: () => patrimonio >= 1000, descripcion: 'Alcanzar 1.000‚Ç¨' },
            { id: 'clasemedia', nombre: 'Clase Media', icono: 'üí∞', condicion: () => patrimonio >= 10000, descripcion: 'Alcanzar 10.000‚Ç¨' },
            { id: 'banquero', nombre: 'El Banquero', icono: 'üè¶', condicion: () => patrimonio >= 100000, descripcion: 'Alcanzar 100.000‚Ç¨' },
            { id: 'millonario', nombre: 'Amancio Ortega', icono: 'üëë', condicion: () => patrimonio >= 1000000, descripcion: 'Alcanzar 1.000.000‚Ç¨' },
            { id: 'ruina', nombre: 'En la ruina', icono: 'üìâ', condicion: () => patrimonio < 0, descripcion: 'Caer en n√∫meros negativos' },

            // Logros de Actividad
            { id: 'calenton', nombre: 'Calent√≥n', icono: 'üî•', condicion: () => relacionesPuntos >= 10, descripcion: '10 puntos en un mes' },
            { id: 'maquina', nombre: 'M√°quina', icono: 'üí™', condicion: () => relacionesPuntos >= 20, descripcion: '20 puntos en un mes' },
            { id: 'conejo', nombre: 'Conejo de campo', icono: 'üê∞', condicion: () => relacionesPuntos >= 30, descripcion: '30+ puntos en un mes' },
            { id: 'monje', nombre: 'Monje Shaolin', icono: 'üò¥', condicion: () => relacionesPuntos === 0 && historial.length > 0, descripcion: '0 puntos en un mes' },
            { id: 'equilibrado', nombre: 'Equilibrado', icono: 'üéØ', condicion: () => relacionesPuntos === 15, descripcion: 'Exactamente 15 puntos' },

            // Easter Eggs
            { id: 'nice', nombre: 'Nice', icono: 'üòè', condicion: () => relacionesPuntos === 6.9 || Math.floor(relacionesPuntos) === 69, descripcion: 'Alcanzar 6.9 o 69 puntos' },
            { id: 'blazeit', nombre: 'Blaze It', icono: 'üåø', condicion: () => patrimonio === 420 || Math.floor(patrimonio) === 420, descripcion: 'Patrimonio de 420‚Ç¨' },

            // Logros de Constancia
            { id: 'primerdia', nombre: 'Primer D√≠a', icono: 'üé¨', condicion: () => true, descripcion: 'Usar la app por primera vez' },
            { id: 'dedicado', nombre: 'Dedicado', icono: '‚≠ê', condicion: () => historial.length >= 3, descripcion: 'Registrar 3 meses' },
            { id: 'veterano', nombre: 'Veterano', icono: 'üèÖ', condicion: () => historial.length >= 12, descripcion: 'Registrar 12 meses' }
        ];

        // ===== FUNCIONES PRINCIPALES =====
        function actualizarDisplays() {
            document.getElementById('patrimonioDisplay').textContent = formatearNumero(patrimonio);
            document.getElementById('relacionesDisplay').textContent = relacionesPuntos.toFixed(1);
            actualizarFraseBroncano();
            verificarLogros();
            actualizarStats();
            actualizarComparador();
            mostrarObjetivos();
        }

        function formatearNumero(num) {
            return new Intl.NumberFormat('es-ES', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(num);
        }

        function modificarPatrimonio(esA√±adir) {
            const input = document.getElementById('patrimonioInput');
            const cantidad = parseFloat(input.value) || 0;

            if (cantidad <= 0) {
                alert('Por favor, introduce una cantidad v√°lida');
                return;
            }

            if (esA√±adir) {
                patrimonio += cantidad;
            } else {
                patrimonio -= cantidad;
            }

            localStorage.setItem('broncano_patrimonio', patrimonio);

            const display = document.getElementById('patrimonioDisplayBox');
            display.classList.add('pulse');
            setTimeout(() => display.classList.remove('pulse'), 500);

            actualizarDisplays();
        }

        function agregarRelacion(puntos) {
            relacionesPuntos += puntos;
            stats.totalRelaciones += puntos;

            // Actualizar racha
            const hoy = new Date().toDateString();
            if (stats.ultimaActividad !== hoy) {
                stats.rachaActual++;
                stats.ultimaActividad = hoy;
                if (stats.rachaActual > stats.mejorRacha) {
                    stats.mejorRacha = stats.rachaActual;
                }
            }

            localStorage.setItem('broncano_relaciones', relacionesPuntos);
            localStorage.setItem('broncano_stats', JSON.stringify(stats));

            const display = document.getElementById('relacionesDisplayBox');
            display.classList.add('pulse');
            setTimeout(() => display.classList.remove('pulse'), 500);

            actualizarDisplays();

            let tipo = puntos === 0.3 ? 'Petting' : puntos === 0.5 ? 'Masturbaci√≥n' : 'Relaci√≥n Completa';
            console.log(`‚úÖ ${tipo} a√±adido (+${puntos} pts)`);
        }

        function resetRelaciones() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar el contador de relaciones? Se guardar√° en el historial.')) {
                // Guardar en historial
                const fecha = new Date();
                const mesAnio = `${fecha.getMonth() + 1}/${fecha.getFullYear()}`;
                historial.push({
                    fecha: mesAnio,
                    puntos: relacionesPuntos,
                    patrimonio: patrimonio
                });

                // Actualizar estad√≠sticas
                if (relacionesPuntos > stats.mejorMes) stats.mejorMes = relacionesPuntos;
                if (relacionesPuntos < stats.peorMes) stats.peorMes = relacionesPuntos;

                localStorage.setItem('broncano_historial', JSON.stringify(historial));
                localStorage.setItem('broncano_stats', JSON.stringify(stats));

                relacionesPuntos = 0;
                localStorage.setItem('broncano_relaciones', relacionesPuntos);
                actualizarDisplays();

                mostrarFraseBroncano('¬°Contador reiniciado! Nuevo mes, nuevas oportunidades üòè');
            }
        }

        // ===== SISTEMA DE LOGROS =====
        function verificarLogros() {
            logrosDefinicion.forEach(logro => {
                if (!logrosDesbloqueados.includes(logro.id) && logro.condicion()) {
                    desbloquearLogro(logro);
                }
            });
            mostrarLogros();
        }

        function desbloquearLogro(logro) {
            logrosDesbloqueados.push(logro.id);
            localStorage.setItem('broncano_logros', JSON.stringify(logrosDesbloqueados));
            mostrarNotificacionLogro(logro);
        }

        function mostrarNotificacionLogro(logro) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-icon">${logro.icono}</div>
                <div><strong>¬°LOGRO DESBLOQUEADO!</strong></div>
                <div>${logro.nombre}</div>
                <div style="font-size: 0.9em; margin-top: 5px;">${logro.descripcion}</div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);

            mostrarFraseBroncano('¬°' + frasesBroncano[Math.floor(Math.random() * frasesBroncano.length)] + '!');
        }

        function mostrarLogros() {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = logrosDefinicion.map(logro => `
                <div class="achievement ${logrosDesbloqueados.includes(logro.id) ? 'unlocked' : ''}">
                    <div class="achievement-icon">${logro.icono}</div>
                    <div class="achievement-name">${logro.nombre}</div>
                </div>
            `).join('');
        }

        // ===== FRASES DE BRONCANO =====
        function actualizarFraseBroncano() {
            const frase = frasesBroncano[Math.floor(Math.random() * frasesBroncano.length)];
            mostrarFraseBroncano(frase);
        }

        function mostrarFraseBroncano(frase) {
            const quoteElement = document.getElementById('broncanoQuote');
            quoteElement.textContent = `"${frase}"`;
            quoteElement.style.animation = 'none';
            setTimeout(() => {
                quoteElement.style.animation = 'fadeIn 0.5s ease';
            }, 10);
        }

        // ===== ESTAD√çSTICAS =====
        function actualizarStats() {
            const statsGrid = document.getElementById('statsGrid');
            const promedio = historial.length > 0
                ? (historial.reduce((sum, h) => sum + h.puntos, 0) / historial.length).toFixed(1)
                : '0.0';

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Hist√≥rico</div>
                    <div class="stat-value">${stats.totalRelaciones.toFixed(1)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mejor Mes</div>
                    <div class="stat-value">${stats.mejorMes > 0 ? stats.mejorMes.toFixed(1) : '-'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Promedio Mensual</div>
                    <div class="stat-value">${promedio}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mejor Racha</div>
                    <div class="stat-value">${stats.mejorRacha} d√≠as</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Meses Registrados</div>
                    <div class="stat-value">${historial.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Logros Desbloqueados</div>
                    <div class="stat-value">${logrosDesbloqueados.length}/${logrosDefinicion.length}</div>
                </div>
            `;
        }

        // ===== COMPARADOR AN√ìNIMO =====
        function actualizarComparador() {
            const comparador = document.getElementById('comparadorInfo');
            let mensaje = '';

            if (relacionesPuntos < 5) {
                mensaje = 'üêå Modo monje: Est√°s en el 20% m√°s tranquilo';
            } else if (relacionesPuntos < 10) {
                mensaje = 'üòä Normalito: En el rango del 40% de usuarios';
            } else if (relacionesPuntos < 20) {
                mensaje = 'üî• Activo: Top 30% de usuarios';
            } else if (relacionesPuntos < 30) {
                mensaje = 'üí™ Muy activo: Top 15% de usuarios';
            } else {
                mensaje = 'üê∞ Leyenda: Top 5% de usuarios. ¬°Incre√≠ble!';
            }

            comparador.innerHTML = `<strong>Tu nivel:</strong> ${mensaje}`;
        }

        // ===== OBJETIVOS =====
        function mostrarModalObjetivos(tipo) {
            const modal = document.getElementById('objetivosModal');
            const content = document.getElementById('objetivosContent');
            const actual = tipo === 'patrimonio' ? patrimonio : relacionesPuntos;
            const objetivo = objetivos[tipo] || 0;

            content.innerHTML = `
                <p style="margin-bottom: 20px;">Define tu objetivo de ${tipo === 'patrimonio' ? 'patrimonio' : 'puntos mensuales'}</p>
                <div class="input-group">
                    <input type="number" id="objetivoInput" value="${objetivo}" min="0" step="${tipo === 'patrimonio' ? '100' : '1'}" style="width: 100%;">
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-add" onclick="guardarObjetivo('${tipo}')" style="width: 100%;">
                        <span>Guardar Objetivo</span>
                    </button>
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn btn-subtract" onclick="eliminarObjetivo('${tipo}')" style="width: 100%;">
                        <span>Eliminar Objetivo</span>
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        }

        function guardarObjetivo(tipo) {
            const valor = parseFloat(document.getElementById('objetivoInput').value);
            if (valor > 0) {
                objetivos[tipo] = valor;
                localStorage.setItem('broncano_objetivos', JSON.stringify(objetivos));
                cerrarModal('objetivosModal');
                actualizarDisplays();
                mostrarFraseBroncano('¬°Objetivo establecido! A por ello üí™');
            }
        }

        function eliminarObjetivo(tipo) {
            delete objetivos[tipo];
            localStorage.setItem('broncano_objetivos', JSON.stringify(objetivos));
            cerrarModal('objetivosModal');
            actualizarDisplays();
        }

        function mostrarObjetivos() {
            // Objetivo de patrimonio
            const patrimonioGoalDiv = document.getElementById('patrimonioGoal');
            if (objetivos.patrimonio) {
                const progreso = Math.min((patrimonio / objetivos.patrimonio) * 100, 100);
                patrimonioGoalDiv.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-size: 0.9em; color: #888;">Objetivo: ${formatearNumero(objetivos.patrimonio)}‚Ç¨</span>
                            <span style="font-size: 0.9em; color: #39ff14;">${progreso.toFixed(0)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progreso}%;">
                                ${progreso >= 20 ? progreso.toFixed(0) + '%' : ''}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                patrimonioGoalDiv.innerHTML = '';
            }

            // Objetivo de relaciones
            const relacionesGoalDiv = document.getElementById('relacionesGoal');
            if (objetivos.relaciones) {
                const progreso = Math.min((relacionesPuntos / objetivos.relaciones) * 100, 100);
                relacionesGoalDiv.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-size: 0.9em; color: #888;">Objetivo: ${objetivos.relaciones} pts</span>
                            <span style="font-size: 0.9em; color: #39ff14;">${progreso.toFixed(0)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progreso}%;">
                                ${progreso >= 20 ? progreso.toFixed(0) + '%' : ''}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                relacionesGoalDiv.innerHTML = '';
            }
        }

        // ===== HISTORIAL =====
        function mostrarModalHistorial() {
            const modal = document.getElementById('historialModal');
            const content = document.getElementById('historialContent');

            if (historial.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #888;">A√∫n no hay historial. ¬°Completa tu primer mes!</p>';
            } else {
                content.innerHTML = historial.slice().reverse().map(h => `
                    <div class="history-item">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>${h.fecha}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>üî• Puntos: ${h.puntos.toFixed(1)}</span>
                            <span>üí∞ Patrimonio: ${formatearNumero(h.patrimonio)}‚Ç¨</span>
                        </div>
                    </div>
                `).join('');
            }

            modal.style.display = 'block';
        }

        // ===== CALCULADORA =====
        function mostrarModalCalculadora() {
            const modal = document.getElementById('calculadoraModal');
            const content = document.getElementById('calculadoraContent');

            const promedioMensual = historial.length > 0
                ? historial.reduce((sum, h) => sum + h.puntos, 0) / historial.length
                : relacionesPuntos;

            const proyeccion3meses = relacionesPuntos + (promedioMensual * 3);
            const proyeccion6meses = relacionesPuntos + (promedioMensual * 6);
            const proyeccion12meses = relacionesPuntos + (promedioMensual * 12);

            content.innerHTML = `
                <div class="stat-card" style="margin-bottom: 20px;">
                    <div class="stat-label">Promedio Mensual</div>
                    <div class="stat-value">${promedioMensual.toFixed(1)} pts</div>
                </div>

                <h3 style="color: #00ffff; margin: 20px 0 15px 0;">üìà Proyecciones</h3>

                <div class="history-item">
                    <strong>En 3 meses</strong>
                    <div class="stat-value" style="font-size: 1.5em;">${proyeccion3meses.toFixed(1)} pts</div>
                </div>

                <div class="history-item">
                    <strong>En 6 meses</strong>
                    <div class="stat-value" style="font-size: 1.5em;">${proyeccion6meses.toFixed(1)} pts</div>
                </div>

                <div class="history-item">
                    <strong>En 12 meses</strong>
                    <div class="stat-value" style="font-size: 1.5em;">${proyeccion12meses.toFixed(1)} pts</div>
                </div>

                <p style="margin-top: 20px; color: #888; font-size: 0.9em; text-align: center;">
                    * Proyecciones basadas en tu promedio actual
                </p>
            `;

            modal.style.display = 'block';
        }

        // ===== EXPORTAR/IMPORTAR =====
        function exportarJSON() {
            const datos = {
                patrimonio,
                relacionesPuntos,
                logrosDesbloqueados,
                historial,
                objetivos,
                stats,
                fechaExportacion: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `broncano-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            mostrarFraseBroncano('¬°Backup exportado correctamente! üíæ');
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const fecha = new Date().toLocaleDateString('es-ES');
            const logrosConseguidos = logrosDesbloqueados.length;
            const promedioMensual = historial.length > 0
                ? (historial.reduce((sum, h) => sum + h.puntos, 0) / historial.length).toFixed(1)
                : '0.0';

            // Colores
            const magenta = [255, 0, 255];
            const cyan = [0, 255, 255];
            const verde = [57, 255, 20];
            const negro = [10, 10, 10];

            // Header con fondo oscuro
            doc.setFillColor(negro[0], negro[1], negro[2]);
            doc.rect(0, 0, 210, 45, 'F');

            // Logo "La Revuelta" estilizado
            doc.setFontSize(32);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(magenta[0], magenta[1], magenta[2]);
            doc.text('LA REVUELTA', 105, 18, { align: 'center' });

            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(cyan[0], cyan[1], cyan[2]);
            doc.text('Informe de las Dos Preguntas Clasicas', 105, 28, { align: 'center' });

            doc.setFontSize(9);
            doc.setTextColor(200, 200, 200);
            doc.text('Generado el ' + fecha, 105, 38, { align: 'center' });

            // L√≠nea separadora
            doc.setDrawColor(magenta[0], magenta[1], magenta[2]);
            doc.setLineWidth(1);
            doc.line(20, 47, 190, 47);

            let y = 62;

            // Secci√≥n Patrimonio
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(magenta[0], magenta[1], magenta[2]);
            doc.text('PREGUNTA 1: CUANTO DINERO TIENES?', 20, y);
            y += 12;

            doc.setFillColor(245, 245, 245);
            doc.roundedRect(20, y, 170, 22, 3, 3, 'F');

            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(verde[0], verde[1], verde[2]);
            const patrimonioTexto = formatearNumero(patrimonio).replace(/\./g, ',') + ' EUR';
            doc.text(patrimonioTexto, 105, y + 15, { align: 'center' });
            y += 35;

            // Secci√≥n Relaciones
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(cyan[0], cyan[1], cyan[2]);
            doc.text('PREGUNTA 2: CUANTAS VECES ESTE MES?', 20, y);
            y += 12;

            doc.setFillColor(245, 245, 245);
            doc.roundedRect(20, y, 170, 22, 3, 3, 'F');

            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(verde[0], verde[1], verde[2]);
            doc.text(relacionesPuntos.toFixed(1).replace('.', ',') + ' puntos', 105, y + 15, { align: 'center' });
            y += 35;

            // L√≠nea separadora
            doc.setDrawColor(cyan[0], cyan[1], cyan[2]);
            doc.setLineWidth(0.5);
            doc.line(20, y, 190, y);
            y += 12;

            // Estad√≠sticas
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(magenta[0], magenta[1], magenta[2]);
            doc.text('ESTADISTICAS', 20, y);
            y += 10;

            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(0, 0, 0);

            const estadisticas = [
                ['Total Historico:', stats.totalRelaciones.toFixed(1).replace('.', ',') + ' pts'],
                ['Mejor Mes:', stats.mejorMes > 0 ? stats.mejorMes.toFixed(1).replace('.', ',') + ' pts' : '-'],
                ['Promedio Mensual:', promedioMensual.replace('.', ',') + ' pts'],
                ['Mejor Racha:', stats.mejorRacha + ' dias consecutivos'],
                ['Meses Registrados:', historial.length.toString()]
            ];

            estadisticas.forEach(([label, value]) => {
                doc.setTextColor(80, 80, 80);
                doc.setFont('helvetica', 'bold');
                doc.text(label, 25, y);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                doc.text(value, 110, y);
                y += 7;
            });

            y += 8;

            // Logros
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(magenta[0], magenta[1], magenta[2]);
            doc.text('LOGROS DESBLOQUEADOS', 20, y);
            y += 10;

            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(0, 0, 0);
            doc.text(logrosConseguidos + ' de ' + logrosDefinicion.length + ' logros conseguidos', 25, y);
            y += 8;

            // Mostrar logros desbloqueados (sin emojis)
            if (logrosDesbloqueados.length > 0) {
                const logrosTexto = logrosDesbloqueados.map(id => {
                    const logro = logrosDefinicion.find(l => l.id === id);
                    return logro ? logro.nombre : '';
                }).filter(t => t);

                doc.setFontSize(9);
                doc.setTextColor(verde[0], verde[1], verde[2]);
                doc.setFont('helvetica', 'bold');

                logrosTexto.forEach((nombre, index) => {
                    if (y > 265) return; // No pasarse de la p√°gina
                    const marca = String.fromCharCode(149); // Bullet point
                    doc.text(marca + ' ' + nombre, 25, y);
                    y += 5;
                });
                y += 5;
            }

            // Historial (√∫ltimos 6 meses)
            if (historial.length > 0 && y < 250) {
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(cyan[0], cyan[1], cyan[2]);
                doc.text('HISTORIAL RECIENTE', 20, y);
                y += 10;

                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                const historialReciente = historial.slice(-6).reverse();

                historialReciente.forEach(h => {
                    if (y > 270) return; // No pasarse de la p√°gina
                    doc.setTextColor(80, 80, 80);
                    doc.setFont('helvetica', 'bold');
                    doc.text(h.fecha, 25, y);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont('helvetica', 'normal');
                    doc.text(h.puntos.toFixed(1).replace('.', ',') + ' pts', 65, y);
                    doc.text(formatearNumero(h.patrimonio).replace(/\./g, ',') + ' EUR', 115, y);
                    y += 6;
                });
            }

            // Footer
            doc.setFontSize(7);
            doc.setTextColor(120, 120, 120);
            doc.setFont('helvetica', 'italic');
            doc.text('Disenado y desarrollado por Javier Benitez Lainez (@jabelainez)', 105, 285, { align: 'center' });
            doc.text('Inspirado en "La Revuelta" de David Broncano', 105, 290, { align: 'center' });

            // Guardar PDF
            doc.save('broncano-informe-' + new Date().toISOString().split('T')[0] + '.pdf');

            mostrarFraseBroncano('Tremendo dato! PDF generado');
        }

        function importarDatos(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const datos = JSON.parse(e.target.result);

                    if (confirm('¬øEst√°s seguro de que quieres importar estos datos? Se sobrescribir√°n los datos actuales.')) {
                        patrimonio = datos.patrimonio || 0;
                        relacionesPuntos = datos.relacionesPuntos || 0;
                        logrosDesbloqueados = datos.logrosDesbloqueados || [];
                        historial = datos.historial || [];
                        objetivos = datos.objetivos || {};
                        stats = datos.stats || stats;

                        localStorage.setItem('broncano_patrimonio', patrimonio);
                        localStorage.setItem('broncano_relaciones', relacionesPuntos);
                        localStorage.setItem('broncano_logros', JSON.stringify(logrosDesbloqueados));
                        localStorage.setItem('broncano_historial', JSON.stringify(historial));
                        localStorage.setItem('broncano_objetivos', JSON.stringify(objetivos));
                        localStorage.setItem('broncano_stats', JSON.stringify(stats));

                        actualizarDisplays();
                        mostrarFraseBroncano('¬°Datos importados correctamente! üìÇ');
                    }
                } catch (error) {
                    alert('Error al importar el archivo. Aseg√∫rate de que es un archivo v√°lido.');
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // ===== MODO P√ÅNICO =====
        function togglePanicMode() {
            document.body.classList.toggle('panic-mode');
        }

        // Salir del modo p√°nico al presionar ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.body.classList.contains('panic-mode')) {
                togglePanicMode();
            }
        });

        // ===== MODALES =====
        function cerrarModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };

        // ===== EVENTOS =====
        document.getElementById('patrimonioInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                modificarPatrimonio(true);
            }
        });

        // Easter egg: Ctrl + Shift + B para borrar todo
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'B') {
                if (confirm('‚ö†Ô∏è ¬øBorrar TODOS los datos? (Patrimonio, Relaciones, Logros e Historial)')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        });

        // ===== INICIALIZACI√ìN =====
        actualizarDisplays();
        mostrarLogros();

        // Verificar logro de primer d√≠a
        if (!logrosDesbloqueados.includes('primerdia')) {
            desbloquearLogro(logrosDefinicion.find(l => l.id === 'primerdia'));
        }
    </script>
</body>
</html>
